let targetOrigin="https://op.churchofjesuschrist.org",targetPath="/index.html",opFrameId="opframe_v1",rp={};function create_opframe(){let e=document.createElement("iframe");e.src=targetOrigin+targetPath,e.id=opFrameId,e.style="width:0px;height:0px;display:none;",document.getElementsByTagName("body")[0].appendChild(e)}function initialize(){document.getElementById(opFrameId)||create_opframe(),document.getElementById(opFrameId).addEventListener("load",e=>{rp.loadCurrentUser()})}function rpReceiveMessage(e){if(e.origin!==targetOrigin)return;let t=JSON.parse(e.data);if("isUserLoggedIn"===t.command){console.debug("rp reports isUSerLoggedIn event, invoking onchanged event");let e=sessionStorage.sessionUser;if(e){let n=JSON.parse(e);n.userId===t.reply.userId?n.status===t.reply.status?(console.debug("user info event triggered"),document.dispatchEvent(new CustomEvent("userinfo",{detail:t.reply}))):(console.debug("user status has changed"),"EXPIRED"===t.reply.status&&(console.debug("user has expired"),document.dispatchEvent(new CustomEvent("sessionexpired",{detail:t.reply})))):(console.debug("user has changed"),0===t.reply.userId?(console.debug("user has logged out"),document.dispatchEvent(new CustomEvent("userloggedout",{detail:t.reply}))):(console.debug("user has logged in"),document.dispatchEvent(new CustomEvent("userloggedin",{detail:t.reply}))))}else document.dispatchEvent(new CustomEvent("coordinatorready",{detail:t.reply}));sessionStorage.sessionUser=JSON.stringify(t.reply)}}function simpleThrottle(e,t){let n=-1;return function(){let s=Date.now();return s>n?(n=s+t,e.apply(null,arguments)):void 0}}function notifyKeepSessionAlive(){console.debug(`In rp.js: Activity was detected. ${new Date}`),rp.notifyActivityDetected()}rp.allowedDomain=function(e){return document.getElementById(opFrameId).src.replace(/\/$/,"")===e},rp.sendMessage=function(e){document.getElementById(opFrameId).contentWindow.postMessage(JSON.stringify(e),targetOrigin)},rp.processMessage=function(e){return JSON.parse(e.data)},rp.makeMessage=function(e,t){return{command:e,payload:t}},rp.loadCurrentUser=function(){let e=rp.makeMessage("isUserLoggedIn","");rp.sendMessage(e)},rp.getCurrentUser=function(){return new Promise(function(e){window.onmessage=t=>{if(!rp.allowedDomain(t.origin))return;let n=JSON.parse(t.data);e(n.reply)};let t=rp.makeMessage("getCurrentUser","");rp.sendMessage(t)})},rp.userLogout=function(){let e=rp.makeMessage("userLogout","");rp.sendMessage(e)},rp.notifyUserLoggedIn=function(){let e=rp.makeMessage("userLoggedIn","");rp.sendMessage(e)},initialize(),window.addEventListener("message",rpReceiveMessage,!1),rp.notifyActivityDetected=function(){let e=rp.makeMessage("activityDetected","");rp.sendMessage(e)};const DELAY=6e4,throttledNotifyKeepSessionAlive=simpleThrottle(notifyKeepSessionAlive,6e4),ACTIVITY_EVENTS=["keyup","mouseup","touchend","scrollend"],PASSIVE_LISTENER_OPTIONS={passive:!0};for(const e of ACTIVITY_EVENTS)document.addEventListener(e,throttledNotifyKeepSessionAlive,PASSIVE_LISTENER_OPTIONS);
